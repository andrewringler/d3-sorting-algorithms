<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <style>
    line {
      fill: none;
      stroke: #000;
      stroke-width: 10px;
    }
  </style>

  <link href="colorbrewer.css" rel="stylesheet">  
  <script src="d3.v2.min.js"></script>
  <script src="quicksort.js"></script>
  <script src="fisher-yates.shuffle.js"></script>
  <script src="colorbrewer.js"></script>
</head>
<body>
  
  <!-- see // see http://bl.ocks.org/1582075 -->
  
  <script>

  var margin = {top: 230, right: 30, bottom: 230, left: 30},
      width = 960 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

  var n = 80,
      index = d3.range(n),
      data = shuffle(index.slice());

  var x = d3.scale.ordinal().domain(index).rangePoints([0, width]),
      a = d3.scale.linear().domain([0, n - 1]).range([height / 5, height]);
      
  var color = d3.scale.quantize()
          .domain([height / 10, height])
          .range(colorbrewer.Blues[9]);
          
  var svg = d3.select("body").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + (margin.top + height) + ")");

  var line = svg.selectAll("line")
      .data(data)
    .enter().append("line")
      .attr("index", function(d, i) { return "i" + i; })
       .style("stroke", function(d) { return color(a(d)); })
      .attr("x2", function(d) { return 0; })
      .attr("y2", function(d) { return -a(d); })
      .attr("transform", function(d, i) { return "translate(" + x(i) + ")"; });

  var actions = quicksort(data).reverse();

  setInterval(function step() {
    var action = actions.pop();
    if (action) switch (action.type) {
      case "partition": {
        line.style("stroke", function(d, i) { return i == action.pivot ? "red" : color(a(d)); });
        step();
        break;
      }
      case "swap": {
        var t = line[0][action.i];
        line[0][action.i] = line[0][action.j];
        line[0][action.j] = t;
        line.attr("transform", function(d, i) { return "translate(" + x(i) + ")"; });
        break;
      }
    }
  }, 200);

  </script>

</body>
</html>